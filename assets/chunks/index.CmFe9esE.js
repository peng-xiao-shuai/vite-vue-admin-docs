/* empty css                 */import{u as Q,E as O}from"./index.BohtUIiO.js";import{L as Z,v as ee,P as Y,a4 as T,p as G,a0 as re,q as S,h as te,Y as oe,d as x,am as ae,$ as le,an as ne,B as se,o as $,b as P,w as z,c as me,F as D,C as ie,k as b,N as pe,r as fe,K as I,H as de,s as ue,x as ce,G as p,ak as U}from"./framework.CklS7oNF.js";import{E as ye,a as he,b as be,c as ve,d as Ie,e as ge}from"./index.BcYfjOIN.js";import{E as xe,a as De,b as Ve,c as Fe,d as we}from"./index.DeRiSD5D.js";import"./theme.sQYGsoaR.js";var v=(e=>(e.VerifyPhone="VerifyPhone",e.VerifyEmail="VerifyEmail",e.VerifyCode="VerifyCode",e.VerifyHttps="VerifyHttps",e.VerifyIp="VerifyIp",e.VerifyNumber="VerifyNumber",e.VerifyEnglish="VerifyEnglish",e.VerifyChinese="VerifyChinese",e.VerifyLength="VerifyLength",e.VerifyEmpty="VerifyEmpty",e))(v||{});const M={en:{VerifyPhone:"Phone format is incorrect",VerifyEmail:"Email address format is incorrect",VerifyCode:"ID card format is incorrect",VerifyHttps:"Website format is incorrect",VerifyIp:"IP address format is incorrect",VerifyNumber:"Only numbers can be entered",VerifyEnglish:"Only English characters can be entered",VerifyChinese:"Only Chinese characters can be entered",VerifyLength:"Character length limit is ",VerifyEmpty:"Can't be empty"},"zh-cn":{VerifyPhone:"手机号格式不正确",VerifyEmail:"邮箱地址格式不正确",VerifyCode:"身份证格式不正确",VerifyHttps:"网址格式不正确",VerifyIp:"IP地址格式不正确",VerifyNumber:"只能输入数字",VerifyEnglish:"只能输入英文字符",VerifyChinese:"只能输入中文字符",VerifyLength:"字符长度限制为 ",VerifyEmpty:"不能为空"}},q=Symbol("powerful-form"),Ce=()=>{var e;return Object.assign(M,((e=Z(q,{}))==null?void 0:e.locale)||{}),{t:t=>{var o,r,l;let m=((l=(r=(o=Q())==null?void 0:o.value)==null?void 0:r.locale)==null?void 0:l.name)||"en";return Object.keys(M).includes(m)||(m="en"),M[m][t]||t}}},Ee=(e,t=(o=>(o=T())==null?void 0:o.proxy)())=>new Promise(o=>{const r=l=>{if(Object.keys(l.refs).includes(e)){o(l.refs[e]);return}else if(l.parent)r(l.parent);else{o(null);return}};ee(()=>{Y(()=>{t?r(t.$):console.error("错误，proxy 空")})})}),ke=(e,t=(o=>(o=T())==null?void 0:o.proxy)())=>{const o=G(null),r=l=>Object.keys(l.refs).includes(e)?l.refs[e]:l.parent?r(l.parent):null;return Y(()=>{t?o.value=r(t.$):console.error("错误，proxy 空")}),o},$e={phone:{pattern:/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-79])|(?:5[0-35-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[1589]))\d{8}$/,message:v.VerifyPhone,trigger:"blur"},email:{type:"email",message:v.VerifyEmail,trigger:"blur"},code:{pattern:/^\d{6}((((((19|20)\d{2})(0[13-9]|1[012])(0[1-9]|[12]\d|30))|(((19|20)\d{2})(0[13578]|1[02])31)|((19|20)\d{2})02(0[1-9]|1\d|2[0-8])|((((19|20)([13579][26]|[2468][048]|0[48]))|(2000))0229))\d{3})|((((\d{2})(0[13-9]|1[012])(0[1-9]|[12]\d|30))|((\d{2})(0[13578]|1[02])31)|((\d{2})02(0[1-9]|1\d|2[0-8]))|(([13579][26]|[2468][048]|0[048])0229))\d{2}))(\d|X|x)$/,message:v.VerifyCode,trigger:"blur"},https:{pattern:/^(((ht|f)tps?):\/\/)?([^!@#$%^&*?.\s-]([^!@#$%^&*?.\s]{0,63}[^!@#$%^&*?.\s])?\.)+[a-z]{2,6}\/?/,message:v.VerifyHttps,trigger:"blur"},ip:{pattern:/^(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}$/,message:v.VerifyIp,trigger:"blur"},number:{pattern:/^\d+$/,message:v.VerifyNumber,trigger:"blur"},english:{pattern:/^[A-Za-z]+$/,message:v.VerifyEnglish,trigger:"blur"},chinese:{pattern:/^[\u4E00-\u9FA5]+$/,message:v.VerifyChinese,trigger:"blur"}},R=Object.assign($e),_=(e,t)=>t(e),Re=e=>({[d.Switch]:"FSwitch",[d.Input]:"FInput",[d.Textarea]:"FInput",[d.Rate]:"FRate",[d.Select]:"FSelect",[d.DatePicker]:"FDatePicker",[d.Radio]:"FRadio",[d.Checkbox]:"FCheckbox",[d.UploadFile]:"FUploadFile",[d.UploadMedia]:"FUploadMedia"})[e],J=(e,t)=>{if(e){if(typeof e=="boolean")return e;e(t)}return!1},B=e=>e==null?void 0:e.replace(/[：:]{1}\s*$/g,"");var d=(e=>(e.Select="select",e.Input="input",e.Switch="switch",e.Rate="rate",e.Slot="slot",e.Textarea="textarea",e.DatePicker="datePicker",e.UploadFile="uploadFile",e.Radio="radio",e.Checkbox="checkbox",e.UploadMedia="uploadMedia",e))(d||{});const g={},Te={formItems:{type:Array,default:()=>[]},extendTable:{type:[Boolean,String],default:!1},formDataDefault:{type:Object,default:()=>({})},disabled:{type:Boolean,default:!1},showType:{type:String,default:void 0},property:{type:Object,default:()=>({})},apis:{type:[Object,Function],default:void 0},showLabel:{type:Boolean,default:!0}},V=()=>({formItem:{type:Object,default:()=>({})},formData:{type:Object,default:()=>({})},index:{type:Number},inline:{type:Boolean,default:!1}}),F=(e,t)=>_(t,o=>typeof o!="function")?t:t(e),je=e=>{var t;const o=(t=T())==null?void 0:t.proxy,r=re({formItems:[],rules:{},formData:{},watchCache:[]}),l=G(null),{t:m}=Ce(),s=(a,n)=>{var i,h,E;const c=Object.values(d).includes(n.type),k=N({text:n.text||a.label,prop:((i=n.formItem)==null?void 0:i.prop)||n.prop,render:c?n.render:void 0,type:c?n.type:void 0,slotName:n.slotName,...n.formItem||{},data:c&&!((h=n.formItem)!=null&&h.data)?n.data||{}:{...c?n.data:{},...(E=n.formItem)==null?void 0:E.data}});r.formItems.push(k),f(k,r.formData,n),u(k)},u=a=>{if(a.rule&&_(a.rule,i=>Array.isArray(i)&&typeof i[0]=="object"&&!Array.isArray(i[0]))){r.rules[a.prop]=a.rule;return}const n=[];a.rule&&(n.push({required:!0,message:`${B(a.text)} ${m(v.VerifyEmpty)}`,trigger:"blur"}),Array.isArray(a.rule)?n.push({min:a.rule[0],max:a.rule[1],message:`${m(v.VerifyLength)}${a.rule[0]} ~ ${a.rule[1]}`,trigger:"blur"}):typeof a.rule=="string"&&(R[a.rule]?n.push({...R[a.rule],message:m(R[a.rule].message)}):console.warn(`${R[a.rule]?"在 verifyFormItemRule 中存在":"在 verifyFormItemRule 中不存在"} 支持 ${Object.keys(R).join("、")}`)),r.rules[a.prop]=n)},f=(a,n,i)=>{var h,E;switch(Object.assign(r.formData,e.formDataDefault||{}),r.formData[a.prop]=((h=e.formDataDefault)==null?void 0:h[a.prop])??a.defaultData??"",g[a.prop]=a.defaultData??"",a.type){case"select":i&&!((E=a.data)!=null&&E.options)&&Array.isArray(i.filters)&&(a.data.options=i.filters.map(c=>({label:c.value,value:c.key}))),n[a.prop]=n[a.prop]||void 0,g[a.prop]=a.defaultData??"";break;case"rate":n[a.prop]=Number.isNaN(Number(n[a.prop]))?0:Number(n[a.prop]);break;case"checkbox":n[a.prop]=typeof n[a.prop]=="string"?n[a.prop].split(",").filter(c=>c.length):Array.isArray(n[a.prop])?n[a.prop]:[],g[a.prop]=a.defaultData||[];break}},C=a=>{r.formItems=[],Object.keys(g).forEach(n=>delete g[n]),a.forEach(n=>{Array.isArray(n.props)?n.props.filter(i=>i.formItem).forEach(i=>{s(n,i)}):n.props.formItem&&s(n,n.props)})};r.watchCache.push(S(()=>e.extendTable,a=>{if(a){let n=[];Ee(typeof a=="boolean"?"PTable":a,o).then(i=>{n=i==null?void 0:i.headerLists,C(n)})}},{immediate:!0}),S(()=>e.formDataDefault,a=>{r.formData=N(g),Object.assign(r.formData,a||{})},{immediate:!0,deep:!0}),S(()=>e.formItems,a=>{a&&e.extendTable===!1&&(r.formItems=a,Object.keys(g).forEach(n=>delete g[n]),r.formItems.forEach(n=>{u(n),f(n,r.formData)}))},{immediate:!0,deep:!0}));const j=te(()=>r.formItems.filter(a=>(Array.isArray(a.showType)?a.showType.includes(e.showType||""):a.showType===e.showType)||!e.showType||!a.showType));return oe(()=>{r.watchCache.forEach(a=>a())}),{formViewData:r,formRenderItems:j,elFormRef:l,transformHeader:C}},Oe=(e,t,o,r)=>({submitForm:(l={},m)=>(o.value.validate().then(()=>{var s,u,f;e.apis&&(_(e.apis,C=>!!Object.keys(C).length)?e.showType?(s=e.apis)!=null&&s[e.showType]?(u=e.apis)==null||u[e.showType]({...l,...t.value}).then(()=>{m&&O.success(m.successMessage||"提交成功！")}).catch(()=>{m&&O.error(m.errorMessage||"提交失败！")}):console.error(`apis.${e.showType} 不存在`):console.error("showType 为空，但是 apis 为对象时需要 showType 作为键值。或者 apis 传递一个 Promise"):(f=e.apis)==null||f.call(e,{...l,...t.value}).then(()=>{m&&O.success(m.successMessage||"提交成功！")}).catch(()=>{m&&O.error(m.errorMessage||"提交失败！")}))}).catch(()=>!1),o.value.validate()),resetForm:()=>{t.value=N(g)},refreshRender:(l=typeof e.extendTable=="boolean"?"PTable":e.extendTable,m=(s=>(s=T())==null?void 0:s.proxy)())=>{const s=ke(l,m),u=S(()=>s.value,f=>{f.headerLists&&r(f.headerLists),u()})},bindAttr(l,m,s){var u;return{formItem:l,formData:m,index:s,inline:((u=e.property)==null?void 0:u.inline)||!1}}}),w=e=>({event:(t,...o)=>{var r,l,m;_(e.formItem.data,s=>typeof(s==null?void 0:s.on)!=null)&&((m=(l=(r=e.formItem.data)==null?void 0:r.on)==null?void 0:l[t])==null||m.call(l,{...e},...o))}}),Pe=x({__name:"form-view",props:Te,setup(e,{expose:t}){const{appContext:o}=T();qe(o.app);const r=e,{formViewData:l,formRenderItems:m,elFormRef:s,transformHeader:u}=je(r),{formData:f,rules:C}=ae(l),{bindAttr:j,submitForm:a,resetForm:n,refreshRender:i}=Oe(r,f,s,u);return t({$slots:le(),$attrs:ne(),$refs:{elFormRef:s},props:r,powerfulFormData:l,formItems:m.value,submitForm:a,resetForm:n,refreshRender:i}),(h,E)=>{var c;const k=se("FRenderJsx"),W=xe,K=De;return $(),P(K,I(h.property,{ref_key:"elFormRef",ref:s,model:b(f),rules:r.showType==="query"?{}:b(C),disabled:h.disabled,style:(c=h.property)!=null&&c.inline?{}:{display:"flex",flexWrap:"wrap",justifyContent:"space-between"}}),{default:z(()=>[($(!0),me(D,null,ie(b(m),(y,L)=>($(),P(W,{key:y.prop,prop:y.prop,label:h.showLabel?b(B)(y.text):"",style:pe({flexBasis:(y==null?void 0:y.basis)||"100%"})},{default:z(()=>[y.type=="slot"?fe(h.$slots,y.slotName||"default",{key:0,index:L},void 0,!0):typeof y.render=="function"?($(),P(k,I({key:1,ref_for:!0},b(j)(y,b(f),L)),null,16)):($(),P(de(b(Re)(y.type||b(d).Input)),I({key:2,ref_for:!0},b(j)(y,b(f),L),{"onUpdate:modelValue":X=>b(f)[y.prop]=X}),null,16,["onUpdate:modelValue"]))]),_:2},1032,["prop","label","style"]))),128))]),_:3},16,["model","rules","disabled","style"])}}}),Ae=(e,t)=>{const o=e.__vccOpts||e;for(const[r,l]of t)o[r]=l;return o},H=Ae(Pe,[["__scopeId","data-v-4ab05853"]]);H.install=e=>{e.component("PowerfulForm",H)};const Se=H,Ue=x({name:"FInput",props:V(),emits:["update:modelValue"],setup(e,{emit:t}){const o=e.formItem.data,{event:r}=w({formData:e.formData,index:e.index,formItem:e.formItem}),l=G(e.formData[e.formItem.prop]),m=ue(()=>{l.value=e.formData[e.formItem.prop]});return ce(()=>{m()}),()=>p(D,null,[p(ye,I({style:(o==null?void 0:o.style)||{},placeholder:`请输入${B(e.formItem.text)}`,modelValue:l.value,"onUpdate:modelValue":s=>l.value=s,onBlur:(...s)=>r("blur",...s),onFocus:(...s)=>r("focus",...s),onChange:s=>{t("update:modelValue",s),r("change",s)},onInput:(...s)=>r("input",...s),onClear:(...s)=>r("clear",...s)},{rows:3,clearable:!0,type:e.formItem.type||d.Input,...F({formData:e.formData,index:e.index,formItem:e.formItem},o==null?void 0:o.property)}),{[o==null?void 0:o.slot]:()=>p("span",{style:{padding:"0 10px"}},[o==null?void 0:o.symbol])})])}}),Ne=x({name:"FSwitch",props:V(),setup(e){const t=e.formItem.data,{event:o}=w({formData:e.formData,index:e.index,formItem:e.formItem});return()=>p(D,null,[p(he,I({style:(t==null?void 0:t.style)||{},modelValue:e.formData[e.formItem.prop],"onUpdate:modelValue":r=>e.formData[e.formItem.prop]=r,"active-value":"1","inactive-value":"0",onChange:(...r)=>{o("change",...r)}},F({formData:e.formData,index:e.index,formItem:e.formItem},t==null?void 0:t.property)),null)])}}),_e=x({name:"FRate",props:V(),emits:["update:modelValue"],setup(e,{emit:t}){const o=e.formItem.data,{event:r}=w({formData:e.formData,index:e.index,formItem:e.formItem});return()=>p(D,null,[p(be,I({modelValue:e.formData[e.formItem.prop],"onUpdate:modelValue":l=>e.formData[e.formItem.prop]=l,style:(o==null?void 0:o.style)||{},"allow-half":!0,onChange:l=>{t("update:modelValue",l),r("change",l),setTimeout(()=>{console.log(e.formData[e.formItem.prop],l)},1e3)}},F({formData:e.formData,index:e.index,formItem:e.formItem},o==null?void 0:o.property)),null)])}}),Be=x({name:"FSelect",props:V(),setup(e){const t=e.formItem.data,{event:o}=w({formData:e.formData,index:e.index,formItem:e.formItem});return()=>p(D,null,[p(Ve,I({modelValue:e.formData[e.formItem.prop],"onUpdate:modelValue":r=>e.formData[e.formItem.prop]=r,style:(t==null?void 0:t.style)||(e.inline?{width:"192px"}:{width:"100%"}),options:(t==null?void 0:t.options)||[],onChange:(...r)=>{o("change",...r)},placeholder:`请选择${B(e.formItem.text)}`,clearable:!0},F({formData:e.formData,index:e.index,formItem:e.formItem},t==null?void 0:t.property)),{default:()=>{var r,l;return(l=(r=t==null?void 0:t.slots)==null?void 0:r.default)==null?void 0:l.call(r,U,e.formData,e.index)},empty:()=>{var r,l;return(l=(r=t==null?void 0:t.slots)==null?void 0:r.empty)==null?void 0:l.call(r,U,e.formData,e.index)},prefix:()=>{var r,l;return(l=(r=t==null?void 0:t.slots)==null?void 0:r.prefix)==null?void 0:l.call(r,U,e.formData,e.index)}})])}}),Le=x({name:"FDatePicker",props:V(),setup(e){const t=e.formItem.data,{event:o}=w({formData:e.formData,index:e.index,formItem:e.formItem});return()=>p(D,null,[p(ve,I({modelValue:e.formData[e.formItem.prop],"onUpdate:modelValue":r=>e.formData[e.formItem.prop]=r,style:(t==null?void 0:t.style)||(e.inline?{}:{width:"100%"}),"start-placeholder":"开始时间","end-placeholder":"结束时间",onChange:(...r)=>o("change",...r),onBlur:(...r)=>o("blur",...r),onFocus:(...r)=>o("focus",...r),onCalendarChange:(...r)=>o("calendar-change",...r),onPanelChange:(...r)=>o("panel-change",...r),onVisibleChange:(...r)=>o("visible-change",...r),valueFormat:"YYYY-MM-DD HH:mm:ss",type:"daterange",clearable:!0},F({formData:e.formData,index:e.index,formItem:e.formItem},t==null?void 0:t.property)),null)])}}),Me=x({name:"FRadio",props:V(),setup(e){const t=e.formItem.data,{event:o}=w({formData:e.formData,index:e.index,formItem:e.formItem});return()=>p(D,null,[p(Fe,I({modelValue:e.formData[e.formItem.prop],"onUpdate:modelValue":r=>e.formData[e.formItem.prop]=r,style:(t==null?void 0:t.style)||{},onChange:(...r)=>o("change",...r)},F({formData:e.formData,index:e.index,formItem:e.formItem},t==null?void 0:t.property)),{default:()=>[t==null?void 0:t.options.map(r=>p(we,{label:r.label,disabled:J(r.disabled,{formData:e.formData,formItem:e.formItem,index:e.index}),border:r.border,name:r.name},{default:()=>[r.text||r.label]}))]})])}}),He=x({name:"FCheckbox",props:V(),setup(e){const t=e.formItem.data,{event:o}=w({formData:e.formData,index:e.index,formItem:e.formItem});return()=>p(D,null,[p(Ie,I({modelValue:e.formData[e.formItem.prop],"onUpdate:modelValue":r=>e.formData[e.formItem.prop]=r,style:(t==null?void 0:t.style)||{},onChange:(...r)=>o("change",...r)},F({formData:e.formData,index:e.index,formItem:e.formItem},t==null?void 0:t.property)),{default:()=>[t==null?void 0:t.options.map(r=>p(ge,{label:r.label,disabled:J(r.disabled,{formData:e.formData,formItem:e.formItem,index:e.index}),border:r.border,name:r.name},{default:()=>[r.text||r.label]}))]})])}}),Ge=x({name:"FRenderJsx",props:V(),setup(e){return()=>{var t,o;return p(D,null,[(o=(t=e.formItem).render)==null?void 0:o.call(t,U,e.formData,e.index)])}}}),ze=Ge,Ye=[Ue,Ne,_e,Be,Le,Me,He,ze],A=e=>Object.prototype.toString.call(e).slice(8,-1),N=e=>{let t;A(e)==="Object"?t={}:A(e)==="Array"?t=[]:t=e;for(const o in e){const r=e[o];A(r)==="Object"||A(r)==="Array"?t[o]=N(r):t[o]=r}return t},rr=e=>e,qe=e=>{Ye.forEach(t=>{e._context.components[t.name]||e.component(t.name,t)})},Je=(e=[])=>(t,o)=>{e.forEach(r=>{t.use(r)}),t.provide(q,o||{})},tr={install:Je([Se])};export{d as FormTypeEnum,H as FormViewComponent,v as LangKey,Se as PowerfulForm,B as clearSymbol,qe as componentRegister,N as deepClone,tr as default,rr as formViewSetData,A as getType,J as isBolOrFun,_ as isTypeProtect,Re as matchComponents,Ee as useAsyncGetRefs,ke as useGetRefs,$e as verify,R as verifyFormItemRule};
